var $ = require('ruby');

$.__proto__.protect_node = function(code) {
  return function() {
    var args = arguments;
    return $.protect(function() {
      return code.apply(this, args);
    }, function(e) {
      console.log("Exception in Ruby code: " + this.funcall(e, 'to_s'));
    });
  };
}

$.define_method($.c.Kernel, 'require', 1, function(self, file) {
  file = this.to_str(file).value;

  // temporary
  if(file[0] != '.')
    require('ruby/' + file);
  else
    require(file);

  return $.builtin.Qnil;
});

var NodeJS = $.define_module('NodeJS');

module.exports = NodeJS;
